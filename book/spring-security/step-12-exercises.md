## Техническое задание на разработку минисервиса обмена сообщениями

### 1. Цель проекта

Разработать минисервис на Java Spring, который позволит пользователям обмениваться сообщениями, используя существующую систему аутентификации и авторизации.

### 2. Функциональные требования

#### 2.1. Отправка сообщений

- Пользователь должен иметь возможность отправить сообщение другому пользователю, указав его email.
- Система должна проверять существование получателя по указанному email.
- При отправке сообщения должны сохраняться следующие данные:
  - Уникальный идентификатор сообщения
  - Email отправителя
  - Email получателя
  - Текст сообщения
  - Дата и время отправки
  - При необходимости, другие

#### 2.2. Получение сообщений

- Пользователь должен иметь возможность просматривать список полученных сообщений.
- Система должна предоставлять возможность фильтрации сообщений по отправителю.
- Должна быть реализована пагинация для списка сообщений.

#### 2.3. Ответ на сообщения

- Пользователь должен иметь возможность ответить на полученное сообщение.
- При ответе система должна \*автоматически заполнять поле получателя email'ом отправителя исходного сообщения.

#### 2.4. Удаление сообщений

- Пользователь должен иметь возможность удалять отправленные и полученные сообщения.
- Удаление должно быть логическим (пометка сообщения как удаленного без физического удаления из базы данных).

### 3. Технические требования

#### 3.1. Архитектура

- Использовать Spring Boot для создания RESTful API.
- Применить принципы чистой архитектуры (Clean Architecture) для разделения слоев приложения.

#### 3.2. База данных

- Использовать реляционную базу данных (например, MySQL, PostgreSQL).
- Применить ORM для работы с базой данных.
- Основа структуры таблицы для хранения сообщений:

```sql
CREATE TABLE messages (
    id BIGINT NOT NULL AUTO_INCREMENT,
    from_email VARCHAR(255) NOT NULL,
    to_email VARCHAR(255) NOT NULL,
    text TEXT NOT NULL,
    sent_date TIMESTAMP NOT NULL,
    is_deleted BOOLEAN DEFAULT FALSE,
    PRIMARY KEY (id)
);
```

#### 3.3. API

Примерные эндпоинты:

1. POST /api/messages - отправка нового сообщения
2. GET /api/messages - получение списка сообщений с возможностью фильтрации и пагинации
3. GET /api/messages/{id} - получение конкретного сообщения по ID
4. POST /api/messages/{id}/reply - ответ на конкретное сообщение
5. DELETE /api/messages/{id} - пометка сообщения как удаленного

#### 3.4. Модель данных

Примерная модель представления сообщения:

```json
{
  "request_ok": true,
  "result": [
    {
      "message": {
        "message_id": 123,
        "from": {
          "id": "fromUser@gmail.com",
          "first_name": "Sergei"
        },
        "to": {
          "id": "toUser@gmail.com",
          "first_name": "NeSergei"
        },
        "date": 1726182827,
        "text": "message text"
      }
    }
  ]
}
```

#### 3.5. Безопасность

- Интегрировать сервис с существующей системой аутентификации и авторизации.
- Обеспечить, чтобы пользователи могли просматривать и отвечать только на сообщения, адресованные им.

#### 3.6. Валидация
- Обрабатывать и возвращать понятные сообщения об ошибках.

#### 3.7. Логирование

- Продумать логирование всех действий, выполняемых пользователями системы, с сохранением в бд.

### 4. Дополнительные требования

- Добавить документацию API (например, используя Swagger).

### 5. Критерии приемки

- Все функциональные требования реализованы и работают корректно.
- Код соответствует стандартам чистого кода.
- API документирован.
- \*Дополнительно: сервис легко интегрируется с фронтенд-частью.
